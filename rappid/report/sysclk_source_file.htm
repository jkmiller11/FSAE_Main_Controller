<HTML>
<pre>/*<br> *######################################################################<br> *                                RAppIDJDP<br> *           Rapid Application Initialization and Documentation Tool<br> *                         Freescale Semiconductor Inc.<br> *<br> *######################################################################<br> *<br> * Project Name           : fsae_main_controller<br> *<br> * Project File           : fsae_main_controller.rsp<br> *<br> * Revision Number        : 1.0<br> *<br> * Tool Version           : 1.3.1.6<br> *<br> * file                   : sysclk_init.c<br> *<br> * Target Compiler        : Codewarrior<br> *<br> * Target Part            : MPC5604B<br> *<br> * Part Errata Fixes      : none<br> *<br> * Project Last Save Date : 06-Jun-2013 02:49:54<br> *<br> * Created on Date        : 06-Jun-2013 02:49:57<br> *<br> * Brief Description      : Mode Entry, System Clock, CMU initialization file.<br> *<br> ******************************************************************************** <br> *<br> * Detail Description     : This file contains definitions for initialization<br> *                         functions of Mode Entry, System Clock and CMU module.<br> *                         Mode Entry function will configure the system SoC for<br> *                         different operating modes. In System Clock function the<br> *                         Clock Generation Module parameters are initialized for<br> *                         DRUN mode. CMU function is initialized to monitor the<br> *                         system clock parameters and report the failures.<br> *<br> ******************************************************************************** <br> *<br> *######################################################################<br>*/<br><br> <br> <br>/********************  Dependent Include files here **********************/<br><br>#include "sysclk_init.h"<br><br><br>/*********************  Initialization Function(s) ************************/<br><br>void sysclk_module_init_fnc(void)<br>{<br>    mode_entry_init_fnc();<br>        /* Mode Entry Initialization Function */<br>    sysclk_init_fnc();<br>        /* System Clock Initialization Function */<br>    cmu_init_fnc();<br>        /* CMU Initialization Function */<br>}<br><br><br>void mode_entry_init_fnc(void)<br>{<br><br>/* ----------------------------------------------------------- */<br>/*              Operating Modes Initialization - Start            */<br>/* ----------------------------------------------------------- */<br><br>/* ----------------------------------------------------------- */<br>/*              Mode Entry Setup            */<br>/* ----------------------------------------------------------- */<br><br>    ME.MER.R = 0x0000001D;<br>        /* STANDBY0 Mode : Disabled    */<br>        /* STOP0 Mode : Disabled    */<br>        /* HALT0 Mode : Disabled    */<br>        /* RUN3 Mode : Disabled    */<br>        /* RUN2 Mode : Disabled    */<br>        /* RUN1 Mode : Disabled    */<br>        /* RUN0 Mode : Enabled    */<br>        /* DRUN Mode : Enabled    */<br>        /* SAFE Mode : Enabled    */<br>        /* TEST Mode : Disabled    */<br>        /* RESET Mode : Enabled    */<br>/*---------------------------TEST Mode--------------------------------*/<br>    ME.TEST.R = 0x001F0010;<br>        /* I/O Power Down Control: Disabled    */<br>        /* Main Voltage Regulator Control: ON    */<br>        /* Data Flash Power Down Control: Normal    */<br>        /* Code Flash Power Down Control: Normal    */<br>        /* System PLL: OFF    */<br>        /* Crystal Oscillator: OFF    */<br>        /* 16MHz IRC:  ON    */<br>        /* System Clock Source: 16MHz internal RC oscillator     */<br>/*---------------------------SAFE Mode--------------------------------*/<br>    ME.SAFE.R  = 0x009F0010;<br>        /* I/O Power Down Control: Enabled    */<br>        /* Main Voltage Regulator Control: ON    */<br>        /* Data Flash Power Down Control: Normal    */<br>        /* Code Flash Power Down Control: Normal    */<br>        /* System PLL: OFF    */<br>        /* Crystal Oscillator: OFF    */<br>        /* 16MHz IRC:  ON    */<br>        /* System Clock Source: 16MHz internal RC oscillator     */<br>/*---------------------------RUN0 Mode--------------------------------*/<br>    ME.RUN[0].R = 0x001F0010;<br>        /* I/O Power Down Control: Disabled    */<br>        /* Main Voltage Regulator Control: ON    */<br>        /* Data Flash Power Down Control: Normal    */<br>        /* Code Flash Power Down Control: Normal    */<br>        /* System PLL: OFF    */<br>        /* Crystal Oscillator: OFF    */<br>        /* 16MHz IRC:  ON    */<br>        /* System Clock Source: 16MHz internal RC oscillator     */<br>/*---------------------------RUN1 Mode--------------------------------*/<br>    ME.RUN[1].R = 0x001F0010;<br>        /* I/O Power Down Control: Disabled    */<br>        /* Main Voltage Regulator Control: ON    */<br>        /* Data Flash Power Down Control: Normal    */<br>        /* Code Flash Power Down Control: Normal    */<br>        /* System PLL: OFF    */<br>        /* Crystal Oscillator: OFF    */<br>        /* 16MHz IRC:  ON    */<br>        /* System Clock Source: 16MHz internal RC oscillator     */<br>/*---------------------------RUN2 Mode--------------------------------*/<br>    ME.RUN[2].R = 0x001F0010;<br>        /* I/O Power Down Control: Disabled    */<br>        /* Main Voltage Regulator Control: ON    */<br>        /* Data Flash Power Down Control: Normal    */<br>        /* Code Flash Power Down Control: Normal    */<br>        /* System PLL: OFF    */<br>        /* Crystal Oscillator: OFF    */<br>        /* 16MHz IRC:  ON    */<br>        /* System Clock Source: 16MHz internal RC oscillator     */<br>/*---------------------------RUN3 Mode--------------------------------*/<br>    ME.RUN[3].R = 0x001F0010;<br>        /* I/O Power Down Control: Disabled    */<br>        /* Main Voltage Regulator Control: ON    */<br>        /* Data Flash Power Down Control: Normal    */<br>        /* Code Flash Power Down Control: Normal    */<br>        /* System PLL: OFF    */<br>        /* Crystal Oscillator: OFF    */<br>        /* 16MHz IRC:  ON    */<br>        /* System Clock Source: 16MHz internal RC oscillator     */<br>/*---------------------------HALT0 Mode--------------------------------*/<br>    ME.HALT0.R = 0x001A0010;<br>        /* I/O Power Down Control: Disabled    */<br>        /* Main Voltage Regulator Control: ON    */<br>        /* Data Flash Power Down Control: Low Power    */<br>        /* Code Flash Power Down Control: Low Power    */<br>        /* System PLL: OFF    */<br>        /* Crystal Oscillator: OFF    */<br>        /* 16MHz IRC:  ON    */<br>        /* System Clock Source: 16MHz internal RC oscillator     */<br>/*---------------------------STOP0 Mode--------------------------------*/<br>    ME.STOP0.R = 0x00150010;<br>        /* I/O Power Down Control: Disabled    */<br>        /* Main Voltage Regulator Control: ON    */<br>        /* Data Flash Power Down Control: Power Down    */<br>        /* Code Flash Power Down Control: Power Down    */<br>        /* System PLL: OFF    */<br>        /* Crystal Oscillator: OFF    */<br>        /* 16MHz IRC:  ON    */<br>        /* System Clock Source: 16MHz internal RC oscillator     */<br>/*---------------------------STANDBY0 Mode--------------------------------*/<br>    ME.STANDBY0.R = 0x0085001F;<br>        /* I/O Power Down Control: Enabled    */<br>        /* Main Voltage Regulator Control: OFF    */<br>        /* Data Flash Power Down Control: Power Down    */<br>        /* Code Flash Power Down Control: Power Down    */<br>        /* System PLL: OFF    */<br>        /* Crystal Oscillator: OFF    */<br>        /* 16MHz IRC:  ON    */<br>        /* System Clock Source: Disable System Clock    */<br><br>/* ----------------------------------------------------------- */<br>/*              Peripheral RUN Mode Configuration            */<br>/* ----------------------------------------------------------- */<br><br>    ME.RUNPC[0].R = 0x00000008;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Enabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[1].R = 0x000000FE;<br>        /* Peripheral Operation in RUN3  mode: Enabled    */<br>        /* Peripheral Operation in RUN2  mode: Enabled    */<br>        /* Peripheral Operation in RUN1  mode: Enabled    */<br>        /* Peripheral Operation in RUN0  mode: Enabled    */<br>        /* Peripheral Operation in DRUN  mode: Enabled    */<br>        /* Peripheral Operation in SAFE  mode: Enabled    */<br>        /* Peripheral Operation in TEST  mode: Enabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[2].R = 0x00000008;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Enabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[3].R = 0x00000008;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Enabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[4].R = 0x00000008;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Enabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[5].R = 0x00000008;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Enabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[6].R = 0x00000008;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Enabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[7].R = 0x00000008;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Enabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br><br>/* ----------------------------------------------------------- */<br>/*              Peripheral Low-Power Mode Configuration            */<br>/* ----------------------------------------------------------- */<br><br>    ME.LPPC[0].R = 0x00000000;<br>        /* Peripheral Operation in STANDBY0 mode: Disabled    */<br>        /* Peripheral Operation in STOP0 mode: Disabled    */<br>        /* Peripheral Operation in HALT0 mode: Disabled    */<br><br>    ME.LPPC[1].R = 0x00000000;<br>        /* Peripheral Operation in STANDBY0 mode: Disabled    */<br>        /* Peripheral Operation in STOP0 mode: Disabled    */<br>        /* Peripheral Operation in HALT0 mode: Disabled    */<br><br>    ME.LPPC[2].R = 0x00000000;<br>        /* Peripheral Operation in STANDBY0 mode: Disabled    */<br>        /* Peripheral Operation in STOP0 mode: Disabled    */<br>        /* Peripheral Operation in HALT0 mode: Disabled    */<br><br>    ME.LPPC[3].R = 0x00000000;<br>        /* Peripheral Operation in STANDBY0 mode: Disabled    */<br>        /* Peripheral Operation in STOP0 mode: Disabled    */<br>        /* Peripheral Operation in HALT0 mode: Disabled    */<br><br>    ME.LPPC[4].R = 0x00000000;<br>        /* Peripheral Operation in STANDBY0 mode: Disabled    */<br>        /* Peripheral Operation in STOP0 mode: Disabled    */<br>        /* Peripheral Operation in HALT0 mode: Disabled    */<br><br>    ME.LPPC[5].R = 0x00000000;<br>        /* Peripheral Operation in STANDBY0 mode: Disabled    */<br>        /* Peripheral Operation in STOP0 mode: Disabled    */<br>        /* Peripheral Operation in HALT0 mode: Disabled    */<br><br>    ME.LPPC[6].R = 0x00000000;<br>        /* Peripheral Operation in STANDBY0 mode: Disabled    */<br>        /* Peripheral Operation in STOP0 mode: Disabled    */<br>        /* Peripheral Operation in HALT0 mode: Disabled    */<br><br>    ME.LPPC[7].R = 0x00000000;<br>        /* Peripheral Operation in STANDBY0 mode: Disabled    */<br>        /* Peripheral Operation in STOP0 mode: Disabled    */<br>        /* Peripheral Operation in HALT0 mode: Disabled    */<br><br><br>/* ----------------------------------------------------------- */<br>/*              Peripheral Mode Control Setup            */<br>/* ----------------------------------------------------------- */<br><br>    /* DSPI_0 Control */<br>    ME.PCTL[4].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* DSPI_1 Control */<br>    ME.PCTL[5].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* DSPI_2 Control */<br>    ME.PCTL[6].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* FlexCAN_0 Control */<br>    ME.PCTL[16].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* FlexCAN_1 Control */<br>    ME.PCTL[17].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* FlexCAN_2 Control */<br>    ME.PCTL[18].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* ADC_0 Control */<br>    ME.PCTL[32].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* I2C Control */<br>    ME.PCTL[44].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* LINFlex_0 Control */<br>    ME.PCTL[48].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* LINFlex_1 Control */<br>    ME.PCTL[49].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* LINFlex_2 Control */<br>    ME.PCTL[50].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* LINFlex_3 Control */<br>    ME.PCTL[51].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* CTU Control */<br>    ME.PCTL[57].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* CANSampler Control */<br>    ME.PCTL[60].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* SIUL Control */<br>    ME.PCTL[68].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* WKPU Control */<br>    ME.PCTL[69].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* eMIOS_0 Control */<br>    ME.PCTL[72].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* eMIOS_1 Control */<br>    ME.PCTL[73].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* RTC/API Control */<br>    ME.PCTL[91].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* PIT Control */<br>    ME.PCTL[92].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br>    /* CMU Control */<br>    ME.PCTL[104].R = 0x09;<br>        /* Peripheral Operation in Debug mode: Disabled    */<br>        /* Low-Power Mode Peripheral Configuration: Low-Power Mode Configuration 1    */<br>        /* RUN Mode Peripheral Configuration: RUN Mode Configuration 1    */<br><br><br>/* ----------------------------------------------------------- */<br>/*              Interrupt Setup            */<br>/* ----------------------------------------------------------- */<br><br>    ME.IM.R = 0x00000000;<br>        /* Invalid Mode Configuration Interrupt: Disabled    */<br>        /* Invalid Mode Interrupt: Disabled    */<br>        /* SAFE Mode Interrupt: Disabled    */<br>        /* Mode Transition Complete Interrupt: Disabled    */<br><br>/* ----------------------------------------------------------- */<br>/*              Operating Modes Initialization - End                */<br>/* ----------------------------------------------------------- */<br><br>}<br><br>void sysclk_init_fnc(void)<br>{<br><br>/* ----------------------------------------------------------- */<br>/*              Enable All Peripheral Clocks            */<br>/* ----------------------------------------------------------- */<br><br>    CGM.SC_DC[0].R =0x80;    <br>        /* Peripheral Set 1 Clock Divider Status: Enabled */<br>        /* Peripheral Set 1 Clock Divider: 1 */<br>    CGM.SC_DC[1].R =0x80;    <br>        /* Peripheral Set 2 Clock Divider Status: Enabled */<br>        /* Peripheral Set 2 Clock Divider: 1 */<br>    CGM.SC_DC[2].R =0x80;    <br>        /* Peripheral Set 3 Clock Divider Status: Enabled */<br>        /* Peripheral Set 3 Clock Divider: 1 */<br><br><br>/* --------------- Set Maximum CMU RC Divider  --------------- */<br>    CGM.CMU_CSR.R = 0x00000006;<br>        /* RC Clock Division factor: 8  */<br><br><br>/* ----------------------------------------------------------- */<br>/*              Clock Source Configuration            */<br>/* ----------------------------------------------------------- */<br><br>    CGM.FIRC_CTL.R = 0x00000000;<br>        /* IRC Oscillator Trimming: 0    */<br>        /* The 16MHz IRC Clock Divider: 1    */<br><br>    CGM.FXOSC_CTL.R = 0x00800000;<br>        /* Oscillator Output is Disabled as rootclock    */<br>        /* The End of Count Value for XOSC = 0x80    */<br>        /* The XOSC Clock Interrupt: Disabled    */<br>        /* The XOSC Clock Divider: 1    */<br><br>    CGM.FMPLL_CR.R = 0x05400000;<br>        /* Input Division Factor: 2    */<br>        /* Output Division Factor: 4    */<br>        /* Loop Division Factor: 64    */<br>        /* Progressive Clock Switching Disabled in Standby Mode    */<br><br>    CGM.FMPLL_MR.R = 0x00000000;<br>        /* The selected Spread Type: Down Spread    */<br>        /* The Modulation Period for FMPLL: 0    */<br>        /* Frequency modulation for PLL: Disabled    */<br>        /* The Increment Step for FMPLL: 0    */<br><br><br><br>/* ----------------------------------------------------------- */<br>/*                    System Clock Setup (16MHz IRC)                 */<br>/* ----------------------------------------------------------- */<br><br>    ME.DRUN.R = 0x001F0070;<br>        /* I/O Power Down Control: Disabled    */<br>        /* Main Voltage Regulator Control: Enabled    */<br>        /* Data Flash Power Down Control: Normal    */<br>        /* Code Flash Power Down Control: Normal    */<br>        /* System PLL: ON    */<br>        /* Crystal Oscillator: ON    */<br>        /* 16MHz IRC: ON    */<br>        /* System Clock Source: 16MHz internal RC oscillator     */<br><br>        /* Re-enter in DRUN mode to update the configuration*/<br>    ME.MCTL.R = 0x30005AF0;    <br>        /* Mode & Key */<br>    ME.MCTL.R = 0x3000A50F;    <br>        /* Mode & Key  Inverted */<br>    while(0x1 == ME.GS.B.S_MTRANS){};    <br>        /* Wait for mode entry to complete */<br>    while(0x3 != ME.GS.B.S_CURRENTMODE){};    <br>        /* Check DRUN mode has been entered  */<br><br>        /* Poll Global Status Register to get current System Clock */<br>    while(0x0!= ME.GS.B.S_SYSCLK){};    <br>        /* Fail is stuck here */<br><br><br><br>/* ----------------------------------------------------------- */<br>/*          Activate the clock Configuration              */<br>/* -----------------------------------------------------------  */<br><br>    ME.MCTL.R = ((ME.GS.B.S_CURRENTMODE << 28) | 0x00005AF0);    <br>    ME.MCTL.R = ((ME.GS.B.S_CURRENTMODE << 28) | 0x0000A50F);    <br><br>/* ----------------------------------------------------------- */<br>/*                    System Output Clock Setup                 */<br>/* ----------------------------------------------------------- */<br><br>    CGM.OCDS_SC.R = 0x00000000;    <br>        /* Clock Divider: 1 */<br>        /* Output Clock Source: Crystal Oscillator */<br>    CGM.OC_EN.B.EN = 0x0;    <br>        /* Output Clock: Disabled */<br><br>/* ----------------------------------------------------------- */<br>/*                    Low Power Clock Setup                 */<br>/* ----------------------------------------------------------- */<br>/* ------------------------LPOSC 32KHz Configuration------------------- */<br>    CGM.SXOSC_CTL.R = 0x00800000;    <br>        /* LP Oscillator Output is Enabled as rootclock */<br>        /* The End of Count Value for LPOSC = 0x80 */<br>        /* The LPOSC Clock Interrupt: Disabled */<br>        /* The LPOSC Clock Divider: 1 */<br>        /* Crystal Oscillator Powerdown Control: Disabled*/<br><br><br>/* ------------------------128KHz Slow IRC Configuration------------------- */<br>    CGM.SIRC_CTL.R = 0x00000310;    <br>        /* LPRC Oscillator Trimming: 0x0 */<br>        /* The 128KHz RC Clock Divider = 4 */<br>        /* LPRC Oscillator is switched ON in Standby Mode */<br>}<br><br>void cmu_init_fnc(void)<br>{<br><br>/*-----------------------CMU 0 Setup------------------------*/<br><br>    CGM.CMU_MDR.R = 0x00000000;<br>        /* IRC Measurement Duration in IRC Clock Cycles: 0 */<br><br>    CGM.CMU_HFREFR_A.R = 0x00000FFF;<br>        /* High Frequency Reference Value for FMPLL0: 1023.75MHz */<br><br>    CGM.CMU_LFREFR_A.R = 0x00000000;<br>        /* Low Frequency Reference Value for FMPLL0: 0.0MHz */<br><br>    CGM.CMU_CSR.R = 0x00000006;<br>        /* RC Oscillator to be calibrated by Frequency Meter: 16MHz IRC*/<br>        /* RC Clock Division factor: 8 */<br>        /* Clock Monitoring Unit 0: Disable */<br>}<br><br>void mode_entry_post_config_fnc(void)<br>{<br>/* ----------------------------------------------------------- */<br>/*              Peripheral RUN Mode Configuration            */<br>/* ----------------------------------------------------------- */<br><br>    ME.RUNPC[0].R = 0x00000000;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Disabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[1].R = 0x000000FE;<br>        /* Peripheral Operation in RUN3  mode: Enabled    */<br>        /* Peripheral Operation in RUN2  mode: Enabled    */<br>        /* Peripheral Operation in RUN1  mode: Enabled    */<br>        /* Peripheral Operation in RUN0  mode: Enabled    */<br>        /* Peripheral Operation in DRUN  mode: Enabled    */<br>        /* Peripheral Operation in SAFE  mode: Enabled    */<br>        /* Peripheral Operation in TEST  mode: Enabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[2].R = 0x00000000;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Disabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[3].R = 0x00000000;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Disabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br><br>    ME.RUNPC[4].R = 0x00000000;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Disabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[5].R = 0x00000000;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Disabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[6].R = 0x00000000;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Disabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>    ME.RUNPC[7].R = 0x00000000;<br>        /* Peripheral Operation in RUN3  mode: Disabled    */<br>        /* Peripheral Operation in RUN2  mode: Disabled    */<br>        /* Peripheral Operation in RUN1  mode: Disabled    */<br>        /* Peripheral Operation in RUN0  mode: Disabled    */<br>        /* Peripheral Operation in DRUN  mode: Disabled    */<br>        /* Peripheral Operation in SAFE  mode: Disabled    */<br>        /* Peripheral Operation in TEST  mode: Disabled    */<br>        /* Peripheral Operation in RESET  mode: Disabled    */<br><br>/* ----------------------------------------------------------- */<br>/*      DRUN  Clock & Peripheral Clock Divider Settings    */<br>/* ----------------------------------------------------------- */<br><br>    ME.DRUN.R = 0x001F0030;<br>        /* I/O Power Down Control: Disabled    */<br>        /* Main Voltage Regulator Control: Enabled    */<br>        /* Data Flash Power Down Control: Normal    */<br>        /* Code Flash Power Down Control: Normal    */<br>        /* System PLL: OFF    */<br>        /* Crystal Oscillator: ON    */<br>        /* 16MHz IRC:  ON    */<br>        /* System Clock Source: 16MHz internal RC oscillator     */<br><br>    CGM.SC_DC[0].R =0x80;    <br>        /* Peripheral Set 1 Clock Divider Status: Enabled */<br>        /* Peripheral Set 1 Clock Divider: 1 */<br>    CGM.SC_DC[1].R =0x80;    <br>        /* Peripheral Set 2 Clock Divider Status: Enabled */<br>        /* Peripheral Set 2 Clock Divider: 1 */<br>    CGM.SC_DC[2].R =0x80;    <br>        /* Peripheral Set 3 Clock Divider Status: Enabled */<br>        /* Peripheral Set 3 Clock Divider: 1 */<br><br><br>/* ----------------------------------------------------------- */<br>/*                     DRUN Re-Entry                    */<br>/* ----------------------------------------------------------- */<br><br>        /* Re-enter in DRUN mode to update the configuration*/<br>    ME.MCTL.R = 0x30005AF0;    <br>        /* Mode & Key */<br>    ME.MCTL.R = 0x3000A50F;    <br>        /* Mode & Key  Inverted */<br>    while(0x1 == ME.GS.B.S_MTRANS){};    <br>        /* Wait for mode entry to complete */<br>    while(0x3 != ME.GS.B.S_CURRENTMODE){};    <br>        /* Check DRUN mode has been entered  */<br><br>}<br> <br>/*<br> *######################################################################<br> *                           End of File<br> *######################################################################<br>*/<br><br></pre></BODY></HTML>
